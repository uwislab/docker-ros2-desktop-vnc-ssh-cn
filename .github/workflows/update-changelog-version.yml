# .github/workflows/changelog.yml
name: Update Changelog & Release
on:
  push:
    branches:
      - main
      - master

jobs:
  changelog:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # è·å–å®Œæ•´æäº¤å†å²

      - uses: TriPSs/conventional-changelog-action@v5
        id: changelog
        with:
          # æ ¸å¿ƒé…ç½®
          token: ${{ secrets.GITHUB_TOKEN }}
          path: 'CHANGELOG.md'           # å˜æ›´æ—¥å¿—è·¯å¾„
          version-file: 'VERSION'        # ç‰ˆæœ¬å·æ–‡ä»¶è·¯å¾„
          commit-message: 'chore: update changelog'  # æäº¤ä¿¡æ¯
          
          # ç‰ˆæœ¬æ§åˆ¶
          version-pattern: '^v?(\d+\.\d+\.\d+)$'  # ç‰ˆæœ¬å·åŒ¹é…è§„åˆ™
          version-prefix: 'v'                   # ç‰ˆæœ¬æ ‡ç­¾å‰ç¼€
          
          # æäº¤ç±»å‹é…ç½®ï¼ˆæŒ‰é‡è¦æ€§æ’åºï¼‰
          types: |
            [
              { "type": "feat", "section": "âœ¨ Features", "hidden": false },
              { "type": "fix", "section": "ğŸ› Bug Fixes", "hidden": false },
              { "type": "perf", "section": "âš¡ Performance Improvements", "hidden": false },
              { "type": "refactor", "section": "â™»ï¸ Code Refactoring", "hidden": false },
              { "type": "docs", "section": "ğŸ“ Documentation", "hidden": false },
              { "type": "test", "section": "âœ… Tests", "hidden": false },
              { "type": "build", "section": "ğŸ—ï¸ Build System", "hidden": false },
              { "type": "ci", "section": "ğŸ”„ Continuous Integration", "hidden": false },
              { "type": "chore", "section": "ğŸ§¹ Maintenance", "hidden": false },
              { "type": "revert", "section": "âª Reverts", "hidden": false }
            ]
          
          # è‡ªå®šä¹‰é…ç½®
          template: |
            {{#each versions}}
            ## {{#if this.tag}}[{{this.version}}]({{this.compareUrl}}){{else}}{{this.version}}{{/if}} ({{this.date}})
            {{#each this.notes}}
            ### {{this.title}}
            {{#each this.commits}}
            - {{#if this.issues}}{{#each this.issues}}[#{{this.number}}]({{this.url}}) {{/each}}{{/if}}{{this.subject}} ({{this.author}})
            {{/each}}
            {{/each}}
            {{/each}}
          
          # è¿‡æ»¤é…ç½®
          filter-by-commit-message: false  # æ˜¯å¦æŒ‰æäº¤ä¿¡æ¯è¿‡æ»¤
          filter-commit: '^.+$'            # æäº¤è¿‡æ»¤æ­£åˆ™
          filter-commit-author: '^.+$'     # ä½œè€…è¿‡æ»¤æ­£åˆ™
          
          # å‘å¸ƒé…ç½®
          create-release: true             # åˆ›å»º GitHub Release
          release-title: 'Release {{version}}'  # å‘å¸ƒæ ‡é¢˜
          draft: false                     # æ˜¯å¦ä¸ºè‰ç¨¿
          prerelease: false                # æ˜¯å¦ä¸ºé¢„å‘å¸ƒ
          
          # é«˜çº§é…ç½®
          tag-prefix: 'v'                  # æ ‡ç­¾å‰ç¼€
          compare-url: 'https://github.com/{{owner}}/{{repo}}/compare/{{previousTag}}...{{currentTag}}'  # æ¯”è¾ƒé“¾æ¥
          debug: false                     # è°ƒè¯•æ¨¡å¼